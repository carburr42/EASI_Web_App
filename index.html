<!DOCTYPE html>
<html lang="en">

<!-- EASI.js REFERENCE -->
<script src="EASI.js"></script>

<head>
  <title>EASI Web App</title>

  <!-- TABLE FORMATTING -->
  <style>
    table 
    {
      border-collapse: collapse;
    }
    th, td 
    {
      padding: 6px;
      border: 1px solid black;
    }

    /* Hidden Cell class for aligning: */
    .invis
    {
      border: none;
    }
  </style>

  <p style="text-align:left; border:none; font-style:italic; font-size:19px;">Estimate of Adversary Sequence Interruption</p>

</head>

<body>

  <table>

    <thead>
      <!-- Headings for SMALLER TABLE -->
      <th class="invis"></th>  
      <th>Probability of Guard Communication:</th>
      <th>P(Assessment):</th>
      <th>P(Transmission):</th>
      <th>Response Mean:</th>
      <th>Force Time (in Seconds) Standard Deviation:</th>
    </thead>

    <!-- SMALLER TABLE CONTENTS -->
    <tbody id="smallTable">
      <th class="invis"></th>
      <td><input type="number" placeholder="????" min="0" max="1" step="0.01" onchange="handleChange()"></td>
      <td><input type="number" placeholder="????" min="0" max="1" step="0.01" onchange="handleChange()"></td>
      <td><input type="number" placeholder="????" min="0" max="1" step="0.01" onchange="handleChange()"></td>
      <td><input type="number" placeholder="????" min="0" step="1" onchange="handleChange()"></td>
      <td><input type="number" placeholder="????" min="0" step="0.1" onchange="handleChange()"></td>
    </tbody>

    <tbody><td class="invis"></td></tbody>  

    <!-- HEADINGS -->
    <thead>
      <th colspan="4"></th>
      <th colspan="2">Delays (in Seconds):</th>
    </thead>

    <thead>
      <tr>
        <th>Task:</th>
        <th>Description:</th>
        <th>P(Detection):</th>
        <th>Location:</th>
        <th>Mean:</th>
        <th>Standard Deviation:</th>
      </tr>
    </thead>

    <tbody id="mainTable">
      <!-- Block where table rows will be inserted. -->
    </tbody>

  </table>

  <br>

  <table><tbody><tr>
        <th>Probability of Interruption:</th>
        <th id="EASIresult"></th>
  </tr></tbody></table>

  <br>

  <!-- Table modifying buttons -->
  <button onclick="addRow()">+</button>
  <button onclick="removeRow()">-</button>

  <pre id="output"></pre>

  <script>
    const mainTable = document.getElementById("mainTable");
    const smallTable = document.getElementById("smallTable");
    let rowCount = 0;

    // ROW CONTENTS:
    function createRow(taskNumber) {
      const row = document.createElement("tr");

      // Task
      const taskCell = document.createElement("td");
      taskCell.textContent = taskNumber;
      row.appendChild(taskCell);

      // Description
      const descCell = document.createElement("td");
      descCell.innerHTML = '<input type="text" placeholder "????" onchange="handleChange()">';
      row.appendChild(descCell);

      // P(Detection)
      const detectionCell = document.createElement("td");
      detectionCell.innerHTML = `<input type="number" placeholder="????" min="0" max="1" step="0.01" onchange="handleChange()">`;
      row.appendChild(detectionCell);

      // Location
      const locationCell = document.createElement("td");
      locationCell.innerHTML = 
       `<select onchange="handleChange()">
          <option value="B">B</option>
          <option value="M">M</option>
          <option value="E">E</option>
        </select>`;
       
      row.appendChild(locationCell);

      // Mean
      const meanCell = document.createElement("td");
      meanCell.innerHTML = `<input type="number" placeholder="????" min="0" step="1" onchange="handleChange()">`;
      row.appendChild(meanCell);

      // Standard Deviation
      const deviationCell = document.createElement("td");
      deviationCell.innerHTML = `<input type="number" placeholder="????" min="0" step="0.1" onchange="handleChange()">`;
      row.appendChild(deviationCell);

      return row;
    }

    function addRow() {
      rowCount++;
      const newRow = createRow(rowCount);
      mainTable.appendChild(newRow);
      handleChange();
    }

    function removeRow() {
      if (rowCount > 1) {
        mainTable.removeChild(mainTable.lastChild);
        rowCount--;
        handleChange();
      }
    }

    // Column References [Where "Tasks" is Column 0]
    colDetect = 2;
    colMean = 4;
    colDeviation = 5;

    // DEBUG PRINT STATEMENT
    function handleChange() {

      const results = tablePrint(mainTable);

      document.getElementById("output").textContent =
        "(The following is just for testing that inputs pass through and update live)\n" +
        results.join("\n");

      const ProbabilityOfInterruption = CalculateEASI(mainTable)

      document.getElementById("EASIresult").textContent =                                           // Rounds to 6 decimal places currently.
        Number.isFinite(ProbabilityOfInterruption) ? Math.max(0, Math.min(1, ProbabilityOfInterruption)).toFixed(6) : " ";

    }

    // Set Default row count to 12 <- SHOULD BE 12 (set to 3 for now)
    for (let i = 0; i < 3; i++) {
      addRow();
    }
  </script>

</body>

</html>
